<div class="vacancy-details-container">
  <div class="header-section">
    <div class="header-content">
      <button mat-icon-button (click)="goBack()" class="back-button">
        <mat-icon>arrow_back</mat-icon>
      </button>
      <h1 class="page-title">Job Details</h1>
    </div>
  </div>

  <div class="content-section" *ngIf="vacancy && !isLoading">
    <div class="vacancy-info-grid">
      <!-- Job Information Card -->
      <mat-card class="info-card job-summary-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>work</mat-icon>
            Job Information
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="job-header">
            <h2 class="job-title">{{ vacancy.title }}</h2>
            <div class="job-meta">
              <span class="job-level" [ngClass]="getJobLevelClass(vacancy.level)">
                {{ getJobLevelText(vacancy.level) }}
              </span>
              <span class="job-id">Job ID: {{ vacancy.vacancyID }}</span>
            </div>
          </div>
          <div class="job-details">
            <div class="detail-item">
              <mat-icon>schedule</mat-icon>
              <span>{{ vacancy.experience }} years</span>
            </div>
            <div class="detail-item">
              <mat-icon>groups</mat-icon>
              <span>{{ vacancy.openPositions }} Open Position{{ vacancy.openPositions > 1 ? 's' : '' }}</span>
            </div>
            <div class="detail-item">
              <mat-icon>person</mat-icon>
              <span>Recruiter: {{ vacancy.recruiter }}</span>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Actions Card -->
      <mat-card class="info-card actions-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>touch_app</mat-icon>
            Quick Actions
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="action-buttons">
            <button mat-raised-button color="primary" (click)="applyToJob()">
              <mat-icon>send</mat-icon>
              Apply Now
            </button>
            <button mat-raised-button (click)="shareJob()">
              <mat-icon>share</mat-icon>
              Share Job
            </button>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Detailed Information Tabs -->
    <mat-card class="details-card">
      <mat-tab-group>
        <!-- Job Description Tab -->
        <mat-tab label="Job Description">
          <div class="tab-content">
            <h3>Job Description</h3>
            <p class="job-description-text">{{ vacancy.description }}</p>
            
            <div class="requirements-section">
              <h4>Experience Required</h4>
              <p>{{ vacancy.experience }} years of relevant experience in the field.</p>
            </div>
          </div>
        </mat-tab>

        <!-- Skills Tab -->
        <mat-tab label="Required Skills">
          <div class="tab-content">
            <div class="skills-section">
              <h3>Primary Skills</h3>
              <mat-chip-set>
                <mat-chip *ngFor="let skill of vacancy.primarySkills" class="primary-skill">
                  {{ skill }}
                </mat-chip>
              </mat-chip-set>
            </div>

            <mat-divider class="skills-divider"></mat-divider>

            <div class="skills-section">
              <h3>Secondary Skills</h3>
              <mat-chip-set>
                <mat-chip *ngFor="let skill of vacancy.secondarySkills" class="secondary-skill">
                  {{ skill }}
                </mat-chip>
              </mat-chip-set>
            </div>
          </div>
        </mat-tab>

        <!-- Matching Candidates Tab -->
        <mat-tab label="Matching Candidates">
          <div class="tab-content">
            <div class="matching-candidates-section">
              <h3>Candidates Matching This Position</h3>
              <p class="candidates-summary" *ngIf="totalProfiles > 0">
                Found {{ totalProfiles }} candidate{{ totalProfiles > 1 ? 's' : '' }} with matching skills
              </p>
              <p class="no-candidates" *ngIf="totalProfiles === 0">
                No candidates found with matching skills for this position.
              </p>

              <div class="candidates-table-container" *ngIf="totalProfiles > 0">
                <table mat-table [dataSource]="paginatedProfiles" class="candidates-table">
                  
                  <!-- Candidate Name Column -->
                  <ng-container matColumnDef="candidateName">
                    <th mat-header-cell *matHeaderCellDef>Candidate Name</th>
                    <td mat-cell *matCellDef="let profile" class="candidate-name">
                      <a (click)="viewCandidateDetails(profile.id)" class="candidate-name-link">
                        {{ profile.candidateName }}
                      </a>
                    </td>
                  </ng-container>

                  <!-- ATS Score Column -->
                  <ng-container matColumnDef="atsScore">
                    <th mat-header-cell *matHeaderCellDef>ATS Score</th>
                    <td mat-cell *matCellDef="let profile" class="ats-score">
                      <span class="score-badge" [ngClass]="getAtsScoreClass(profile.atsScore)">
                        {{ profile.atsScore }}%
                      </span>
                    </td>
                  </ng-container>

                  <!-- Experience Column -->
                  <ng-container matColumnDef="overallExperience">
                    <th mat-header-cell *matHeaderCellDef>Experience</th>
                    <td mat-cell *matCellDef="let profile" class="experience">
                      {{ profile.overallExperience }}
                    </td>
                  </ng-container>

                  <!-- Matching Skills Column -->
                  <ng-container matColumnDef="matchingSkills">
                    <th mat-header-cell *matHeaderCellDef>Matching Skills</th>
                    <td mat-cell *matCellDef="let profile" class="matching-skills">
                      <mat-chip-set>
                        <mat-chip *ngFor="let skill of getMatchingSkills(profile).slice(0, 3)" class="matching-skill">
                          {{ skill }}
                        </mat-chip>
                        <mat-chip *ngIf="getMatchingSkills(profile).length > 3" class="more-skills">
                          +{{ getMatchingSkills(profile).length - 3 }} more
                        </mat-chip>
                      </mat-chip-set>
                    </td>
                  </ng-container>

                  <!-- Email Column -->
                  <ng-container matColumnDef="email">
                    <th mat-header-cell *matHeaderCellDef>Email</th>
                    <td mat-cell *matCellDef="let profile" class="email">
                      <a [href]="'mailto:' + profile.email" class="email-link">{{ profile.email }}</a>
                    </td>
                  </ng-container>

                  <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                  <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                </table>

                <!-- Pagination -->
                <mat-paginator 
                  [length]="totalProfiles" 
                  [pageSize]="pageSize" 
                  [pageIndex]="pageIndex"
                  [pageSizeOptions]="[5, 10, 25]"
                  (page)="onPageChange($event)"
                  showFirstLastButtons>
                </mat-paginator>
              </div>
            </div>
          </div>
        </mat-tab>
      </mat-tab-group>
    </mat-card>
  </div>

  <!-- Loading state -->
  <div class="loading-section" *ngIf="isLoading">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Loading vacancy details...</p>
  </div>

  <!-- Error state -->
  <div class="error-section" *ngIf="!vacancy && !isLoading">
    <mat-card class="error-card">
      <mat-card-content>
        <div class="error-content">
          <mat-icon class="error-icon">error_outline</mat-icon>
          <h2>Job Not Found</h2>
          <p>The requested job posting could not be found.</p>
          <button mat-raised-button color="primary" (click)="goBack()">
            <mat-icon>arrow_back</mat-icon>
            Back to Dashboard
          </button>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>
